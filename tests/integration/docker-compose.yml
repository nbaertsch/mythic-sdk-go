version: '3.8'

services:
  mythic:
    image: itsafeaturemythic/mythic_server:latest
    container_name: mythic-test
    ports:
      - "7443:7443"
    environment:
      - MYTHIC_ADMIN_PASSWORD=mythic_password
      - MYTHIC_SERVER_PORT=7443
      - POSTGRES_PASSWORD=mythic_password
      - RABBITMQ_PASSWORD=mythic_password
      - HASURA_SECRET=supersecrethasura
    depends_on:
      - postgres
      - rabbitmq
    networks:
      - mythic-test

  postgres:
    image: postgres:13-alpine
    container_name: mythic-test-postgres
    environment:
      - POSTGRES_DB=mythic_db
      - POSTGRES_USER=mythic_user
      - POSTGRES_PASSWORD=mythic_password
    networks:
      - mythic-test
    volumes:
      - postgres-data:/var/lib/postgresql/data

  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: mythic-test-rabbitmq
    environment:
      - RABBITMQ_DEFAULT_USER=mythic_user
      - RABBITMQ_DEFAULT_PASS=mythic_password
    networks:
      - mythic-test
    volumes:
      - rabbitmq-data:/var/lib/rabbitmq

networks:
  mythic-test:
    driver: bridge

volumes:
  postgres-data:
  rabbitmq-data:
